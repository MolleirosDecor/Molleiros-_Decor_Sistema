<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Molleiros Decor | Sistema de Locação</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  font-family:Segoe UI, Arial;
  background:#fff7f9;
  margin:0;
}
section{
  background:#fff;
  max-width:1100px;
  margin:20px auto;
  padding:20px;
  border-radius:14px;
}
h2{color:#c64f86}
input{padding:8px;width:100%;margin-top:6px}
button{
  background:#f3a6c8;
  border:none;
  padding:10px 16px;
  border-radius:8px;
  margin-top:10px;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #eee;
  padding:8px;
}
th{background:#ffe3ec}
.total{
  font-weight:bold;
  font-size:18px;
  margin-top:10px;
}
.hidden{display:none}
</style>
</head>

<body>

<!-- LOGIN -->
<section id="loginBox">
<h2>Login – Molleiros Decor</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button id="btnLogin">Entrar</button>
</section>

<!-- SISTEMA -->
<div id="sistema" class="hidden">

<!-- DADOS DA EMPRESA -->
<section>
<h2>Dados da Empresa</h2>
<p><b>Molleiros Decor</b><br>
Decoração Infantil – Pegue e Monte<br>
Carapicuíba / SP</p>
</section>

<!-- CLIENTE -->
<section>
<h2>Cliente</h2>
<input id="nome" placeholder="Nome">
<input id="cpf" placeholder="CPF">
<input id="telefone" placeholder="Telefone">
<input id="endereco" placeholder="Endereço">
</section>

<!-- VALORES -->
<section>
<h2>Valores da Locação</h2>
<input id="valorContrato" type="number" placeholder="Valor do contrato">
<input id="sinal" type="number" placeholder="Sinal pago">
<div class="total" id="valorReceber">Valor a receber: R$ 0,00</div>
</section>

<!-- ITENS -->
<section>
<h2>Itens Locados (valores para avaria/extravio)</h2>
<input id="item" placeholder="Item">
<input id="qtd" type="number" placeholder="Qtd">
<input id="valor" type="number" placeholder="Valor do item">
<button onclick="addItem()">Adicionar</button>

<table id="tabelaItens">
<tr><th>Item</th><th>Qtd</th><th>Valor</th><th>Checklist</th></tr>
</table>
</section>

<!-- CONTRATO -->
<section>
<h2>Contrato</h2>
<button onclick="gerarContrato()">Visualizar Contrato</button>
<button onclick="window.print()">Imprimir</button>

<pre id="contrato" style="white-space:pre-wrap;background:#fafafa;padding:15px;border-radius:10px"></pre>
</section>

</div>

<script>
/* SUPABASE */
const client = window.supabase.createClient(
  'https://dpwtogyfwxoibtrrquax.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwd3RvZ3lmd3hvaWJ0cnJxdWF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4MzMyOTUsImV4cCI6MjA4MzQwOTI5NX0.VkDX_uXY2qPFtnEqLFULjRUrN4dACJE86AcawIXZ-44'
);

/* LOGIN */
btnLogin.addEventListener('click', async ()=>{
  const { error } = await client.auth.signInWithPassword({
    email: email.value,
    password: senha.value
  });
  if(error){alert(error.message);return;}
  loginBox.classList.add('hidden');
  sistema.classList.remove('hidden');
});

/* VALORES */
valorContrato.oninput = calcular;
sinal.oninput = calcular;

function calcular(){
  const receber =
    (Number(valorContrato.value)||0) -
    (Number(sinal.value)||0);
  valorReceber.innerText =
    `Valor a receber: R$ ${receber.toFixed(2)}`;
}

/* ITENS */
let itens=[];
function addItem(){
  itens.push(item.value);
  tabelaItens.innerHTML += `
  <tr>
    <td>${item.value}</td>
    <td>${qtd.value}</td>
    <td>R$ ${Number(valor.value).toFixed(2)}</td>
    <td><input type="checkbox"></td>
  </tr>`;
  item.value=qtd.value=valor.value="";
}

/* CONTRATO */
function gerarContrato(){
contrato.innerText = `
CONTRATO DE LOCAÇÃO – PEGUE E MONTE

LOCADORA:
MOLLEIROS DECOR
Decoração Infantil
Carapicuíba / SP

CLIENTE:
${nome.value}
CPF: ${cpf.value}
Telefone: ${telefone.value}
Endereço: ${endereco.value}

VALOR DO CONTRATO:
R$ ${Number(valorContrato.value).toFixed(2)}

SINAL:
R$ ${Number(sinal.value).toFixed(2)}

ITENS LOCADOS:
${itens.join(", ")}

OBS:
Os valores dos itens são apenas para casos de avaria ou extravio.

ASSINATURAS:
_____________________________________
`;
}
</script>

</body>
</html>

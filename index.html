<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Molleiros Decor | Sistema Profissional</title>

<!-- SUPABASE CDN (UMA √öNICA VEZ) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  font-family:Segoe UI,Arial,sans-serif;
  background:#fff7fb;
  margin:0;
  color:#555;
}

/* LOGIN */
#loginBox{
  max-width:420px;
  margin:120px auto;
  background:#fff;
  padding:30px;
  border-radius:20px;
  box-shadow:0 0 18px rgba(0,0,0,.12);
}
#loginBox h2{color:#c64f86;text-align:center}
label{display:block;margin-top:12px}
input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
}
button{
  background:#f8c8dc;
  border:none;
  padding:12px;
  border-radius:12px;
  margin-top:18px;
  cursor:pointer;
  width:100%;
}
button:hover{background:#f4b3cd}

/* SISTEMA */
header{
  background:#f8c8dc;
  padding:18px;
  text-align:center;
}
section{
  background:#fff;
  max-width:1200px;
  margin:20px auto;
  padding:20px;
  border-radius:20px;
  box-shadow:0 0 12px rgba(0,0,0,.06);
}
h2{color:#c64f86;margin-top:0}
.flex{display:flex;gap:12px;flex-wrap:wrap}
.flex>div{flex:1}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  border:1px solid #eee;
  padding:8px;
}
th{background:#fff1c1}
.total{
  font-size:22px;
  color:#c64f86;
  font-weight:bold;
  margin-top:15px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>üîê Login Molleiros Decor</h2>

  <label>Email</label>
  <input id="loginEmail" type="email" value="molleirosdecor@gmail.com">

  <label>Senha</label>
  <input id="loginSenha" type="password">

  <button onclick="login()">Entrar</button>
</div>

<!-- SISTEMA -->
<div id="sistema" style="display:none">

<header>
  <h2>Molleiros Decor ‚Äî Sistema de Loca√ß√£o</h2>
</header>

<section>
  <h2>üë© Cliente</h2>
  <div class="flex">
    <div><label>Nome</label><input id="nome"></div>
    <div><label>CPF</label><input id="cpf"></div>
    <div><label>Telefone</label><input id="telefone"></div>
  </div>
  <label>Endere√ßo</label>
  <input id="endereco">
</section>

<section>
  <h2>üì¶ Itens Locados (Checklist)</h2>
  <div class="flex">
    <div><label>Item</label><input id="item"></div>
    <div><label>Qtd</label><input type="number" id="qtd"></div>
    <div><label>Valor (avaria/extravio)</label><input type="number" id="valor"></div>
  </div>

  <button onclick="addItem()">Adicionar Item</button>

  <table id="tItens">
    <tr>
      <th>‚úî</th>
      <th>Item</th>
      <th>Qtd</th>
      <th>Valor</th>
    </tr>
  </table>
</section>

<section>
  <h2>üí∞ Valores</h2>
  <div class="flex">
    <div>
      <label>Valor do Contrato (R$)</label>
      <input type="number" id="valorContrato" oninput="recalcular()">
    </div>
    <div>
      <label>Sinal Recebido (R$)</label>
      <input type="number" id="sinal" oninput="recalcular()">
    </div>
  </div>

  <div class="total" id="total">Valor a receber: R$ 0,00</div>
</section>

<section>
  <button onclick="window.print()">üñ®Ô∏è Imprimir Contrato</button>
</section>

</div>

<script>
/* ===============================
   SUPABASE ‚Äî CONFIGURA√á√ÉO LIMPA
   (N√ÉO EXISTE const supabase = )
=============================== */
const SUPABASE_URL = 'https://dpwtogyfwxoibtrrquax.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRwd3RvZ3lmd3hvaWJ0cnJxdWF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4MzMyOTUsImV4cCI6MjA4MzQwOTI5NX0.VkDX_uXY2qPFtnEqLFULjRUrN4dACJE86AcawIXZ-44';

const supabaseClient = window.supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

/* ===============================
   LOGIN
=============================== */
async function login(){
  const email = document.getElementById('loginEmail').value;
  const senha = document.getElementById('loginSenha').value;

  const { error } = await supabaseClient.auth.signInWithPassword({
    email,
    password: senha
  });

  if(error){
    alert('Erro no login: ' + error.message);
    return;
  }

  document.getElementById('loginBox').style.display = 'none';
  document.getElementById('sistema').style.display = 'block';
}

/* AUTO LOGIN */
supabaseClient.auth.getSession().then(({ data })=>{
  if(data.session){
    document.getElementById('loginBox').style.display='none';
    document.getElementById('sistema').style.display='block';
  }
});

/* ===============================
   ITENS
=============================== */
let itens = [];

function addItem(){
  if(!item.value || !qtd.value) return;

  itens.push({
    item:item.value,
    qtd:qtd.value,
    valor:valor.value
  });

  document.getElementById('tItens').innerHTML += `
    <tr>
      <td><input type="checkbox"></td>
      <td>${item.value}</td>
      <td>${qtd.value}</td>
      <td>R$ ${Number(valor.value||0).toFixed(2)}</td>
    </tr>
  `;

  item.value='';
  qtd.value='';
  valor.value='';
}

/* ===============================
   VALORES
=============================== */
function recalcular(){
  const v = Number(valorContrato.value)||0;
  const s = Number(sinal.value)||0;
  const receber = v - s;
  total.innerText = 'Valor a receber: R$ ' + receber.toFixed(2);
}
</script>

</body>
</html>
